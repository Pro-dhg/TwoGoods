package com.yamu.data.sample.service.resources.mapper;

import com.yamu.data.sample.service.resources.entity.po.*;
import com.yamu.data.sample.service.resources.entity.vo.ResourceDistributionProvinceVO;
import com.yamu.data.sample.service.resources.entity.vo.ResourceDomainDetailUserSourceVO;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.ResultType;
import org.apache.ibatis.annotations.Select;
import org.springframework.stereotype.Repository;
import java.util.List;

/**
 * @Author Lishuntao
 * @Date 2021/1/21
 */
@Repository
public interface ResourceDomainTopnDetailMapper {


    @Select("<script>"
            + "select parse_time, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt "
            + " from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or </if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.answerFirstIsp != null and queryParam.answerFirstIsp != \"\" '> and answer_first_isp = #{queryParam.answerFirstIsp} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\" '> and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name order by  sum (parse_total_cnt) desc "
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.answerFirstIsp != null and queryParam.answerFirstIsp != \"\" '> and answer_first_isp = #{queryParam.answerFirstIsp} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "group by (parse_time) "
            + "order by parse_time asc"
            + "</script>")
    List<ResourceDomainTopnDetail> findAllGroupByTopnParseTime(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    /**
     * 按照域名精确查询趋势分析.
     *
     * @param queryParam
     * @return
     */
    @Select("<script>"
            + "select parse_time, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt "
            + " from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\"'> and domain_name = #{queryParam.domainName} </if>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "group by (parse_time) "
            + "order by parse_time asc "
            + "</script>")
    List<ResourceDomainTopnDetail> findAllGroupByDoaminParseTime(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    /**
     * 根据Topn查询资源分布.
     *
     * @param queryParam
     * @return
     */
    @Select("<script>"
            + "select isp, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt "
            + " from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1 "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or </if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name order by  sum (parse_total_cnt) desc "
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '> and domain_name = #{queryParam.domainName} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by answer_first_isp as isp"
            + " order by a_record_parse_total_cnt desc"
            + "</script>")
    List<ResourceDomainTopnDetail> findTopnGroupByIsp(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    /**
     * 根据域名精确查询资源分布.
     *
     * @param queryParam
     * @return
     */
    @Select("<script>"
            + "select isp, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt "
            + "from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '> and domain_name = #{queryParam.domainName}  </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by answer_first_isp as isp"
            + " order by a_record_parse_total_cnt desc"
            + "</script>")
    List<ResourceDomainTopnDetail> findDomainGroupByIsp(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " select * from ( "
            + " </if> "
            + "select domain_name,company_short_name,website_app_name,parse_time, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> if(a_record_parse_total_cnt == 0, 0.0, divide(net_in_parse_total_cnt * 100, a_record_parse_total_cnt)) as net_in_rate_val, </if>"
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt,idc_parse_total_cnt+sum(zl_parse_total_cnt + tt_parse_total_cnt + zx_parse_total_cnt) as icpAccuracyParseTotalCnt "
            + "from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or</if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and sum(net_in_parse_total_cnt) = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and sum(within_parse_total_cnt) = 0 </if>"
            + " order by  sum (parse_total_cnt) desc "
            + " <if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by (parse_time,domain_name,company_short_name,website_app_name) "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and net_in_parse_total_cnt = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and within_parse_total_cnt = 0 </if>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " )"
            + "<where>"
            + "<if test='queryParam.netInRateMin != null'> and net_in_rate_val &gt;= #{queryParam.netInRateMin}</if>"
            + "<if test='queryParam.netInRateMax != null'> and net_in_rate_val &lt;= #{queryParam.netInRateMax}</if>"
            + "</where>"
            + "</if>"
            + " order by ${queryParam.orderBy} "
            + "<if test = 'queryParam.limit!=null and queryParam.limit!=\"\"'> limit #{queryParam.limit} "
            + "    <if test = 'queryParam.offset!=null and queryParam.offset!=\"\"'> offset #{queryParam.offset}</if>"
            + "</if>"
            + "</script>")
    List<ResourceDomainTopnDetail> findAllGroupByParseTimeAndDomain(@Param("queryParam") ResourceDomainTopnDetail queryParam);


    @Select("<script>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " select * from ( "
            + " </if> "
            + "select domain_name,company_short_name,website_app_name, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> if(a_record_parse_total_cnt == 0, 0.0, divide(net_in_parse_total_cnt * 100, a_record_parse_total_cnt)) as net_in_rate_val, </if>"
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt,idc_parse_total_cnt+sum(zl_parse_total_cnt + tt_parse_total_cnt + zx_parse_total_cnt) as icpAccuracyParseTotalCnt "
            + "from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or</if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and sum(net_in_parse_total_cnt) = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and sum(within_parse_total_cnt) = 0 </if>"
            + " order by  sum (parse_total_cnt) desc "
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber} </if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '> and isp_code = #{queryParam.ispCode} </if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '> and qtype = #{queryParam.qtype} </if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '> and user_type = #{queryParam.userType} </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '> and districts_code = #{queryParam.districtsCode} </if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '> and province  = #{queryParam.province} </if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '> and city  = #{queryParam.city} </if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '> and district  = #{queryParam.district} </if>"
            + "<if test = 'queryParam.startTime != null'> and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'> and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name,company_short_name,website_app_name "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and net_in_parse_total_cnt = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and within_parse_total_cnt = 0 </if>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " )"
            + "<where>"
            + "<if test='queryParam.netInRateMin != null'> and net_in_rate_val &gt;= #{queryParam.netInRateMin}</if>"
            + "<if test='queryParam.netInRateMax != null'> and net_in_rate_val &lt;= #{queryParam.netInRateMax}</if>"
            + "</where>"
            + "</if>"
            + " order by ${queryParam.orderBy}"
            + "<if test = 'queryParam.limit!=null and queryParam.limit!=\"\"'> limit #{queryParam.limit} "
            + "    <if test = 'queryParam.offset!=null and queryParam.offset!=\"\"'> offset #{queryParam.offset}</if>"
            + "</if>"
            + "</script>")
    List<ResourceDomainTopnDetail> findAllGroupByDomain(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "select count(*)  from ("
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> select * from ( </if>"
            + "select "
            + "parse_time,"
            + "domain_name,"
            + "company_short_name,website_app_name,"
            + "sum(a_record_parse_total_cnt) as a_record_parse_total_cnt,"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> if(a_record_parse_total_cnt == 0, 0.0, divide(net_in_parse_total_cnt * 100, a_record_parse_total_cnt)) as net_in_rate_val, </if>"
            + "sum(net_in_parse_total_cnt) as net_in_parse_total_cnt "
            + "from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or</if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and sum(net_in_parse_total_cnt) = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and sum(within_parse_total_cnt) = 0 </if>"
            + " order by  sum (parse_total_cnt) desc "
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "group by (parse_time,domain_name,company_short_name,website_app_name) "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and net_in_parse_total_cnt = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and sum(within_parse_total_cnt) = 0 </if>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " )"
            + "<where>"
            + "<if test='queryParam.netInRateMin != null'> and net_in_rate_val &gt;= #{queryParam.netInRateMin}</if>"
            + "<if test='queryParam.netInRateMax != null'> and net_in_rate_val &lt;= #{queryParam.netInRateMax}</if>"
            + "</where>"
            + "</if>"
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "</script>")
    @ResultType(Long.class)
    Long countAllGroupByParseTimeAndDomain(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "select count(*)  from ( "
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> select * from ( </if>"
            + "select "
            + "domain_name,company_short_name,website_app_name,"
            + "sum(a_record_parse_total_cnt) as a_record_parse_total_cnt,"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'> if(a_record_parse_total_cnt == 0, 0.0, divide(net_in_parse_total_cnt * 100, a_record_parse_total_cnt)) as net_in_rate_val, </if>"
            + "sum(net_in_parse_total_cnt) as net_in_parse_total_cnt"
            + " from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or</if></foreach></trim></if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name,company_short_name,website_app_name "
            + " HAVING 1=1 "
            + "<if test = 'queryParam.netInZero != null and queryParam.netInZero != \"\" '> and net_in_parse_total_cnt = 0 </if>"
            + "<if test = 'queryParam.withinZero != null and queryParam.withinZero != \"\" '> and sum(within_parse_total_cnt) = 0 </if>"
            + "<if test='queryParam.netInRateMin != null or queryParam.netInRateMax != null'>"
            + " )"
            + "<where>"
            + "<if test='queryParam.netInRateMin != null'> and net_in_rate_val &gt;= #{queryParam.netInRateMin}</if>"
            + "<if test='queryParam.netInRateMax != null'> and net_in_rate_val &lt;= #{queryParam.netInRateMax}</if>"
            + "</where>"
            + "</if>"
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "</script>")
    @ResultType(Long.class)
    Long countAllGroupByDomain(@Param("queryParam") ResourceDomainTopnDetail queryParam);


    @Select("<script>"
            + "select count(*) "
            + "from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '>and domain_name like  concat('%',#{queryParam.domainName},'%')</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</script>")
    Long findByCount(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "select * "
            + "from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '>and domain_name like concat('%',#{queryParam.domainName},'%')</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " order by parse_time desc, parse_total_cnt desc"
            + "<if test = 'queryParam.limit!=null and queryParam.limit!=\"\"'> limit #{queryParam.limit} "
            + "    <if test = 'queryParam.offset!=null and queryParam.offset!=\"\"'> offset #{queryParam.offset}</if>"
            + "</if>"
            + "</script>")
    List<ResourceDomainTopnDetail> findByPage(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + " select"
            + " business_ip,"
            + " answer_first_province as province,"
            + " answer_first_city as city,"
            + " answer_first_isp as isp,"
            + " sum(parse_total_cnt) as parse_total_cnt,"
            + " row_number() over( order by parse_total_cnt desc)"
            + " from ${queryParam.queryTable}"
            + "<where>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '>and domain_name = #{queryParam.domainName}</if>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " </where>"
            + " group by case when  business_ip is null or business_ip ='' then '其他' else business_ip end as business_ip,"
            + " province,"
            + " city,"
            + " isp "
            + "<if test = 'queryParam.limit!=null and queryParam.limit!=\"\"'> limit #{queryParam.limit} "
            + "    <if test = 'queryParam.offset!=null and queryParam.offset!=\"\"'> offset #{queryParam.offset}</if>"
            + "</if>"
            + " settings allow_experimental_window_functions = 1"
            + "</script>")
    List<ResourceDomainTopnDetail> nodeServerDetail(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "select count(*) from ("
            + " select"
            + " business_ip,"
            + " province,"
            + " city,"
            + " isp"
            + " from ${queryParam.queryTable}"
            + "<where>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '>and domain_name = #{queryParam.domainName}</if>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " </where>"
            + " group by case when  business_ip is null or business_ip ='' then '其他' else business_ip end as business_ip,"
            + " province,"
            + " city,"
            + " isp "
            + "<if test = 'queryParam.limit!=null and queryParam.limit!=\"\"'> limit #{queryParam.limit} "
            + "    <if test = 'queryParam.offset!=null and queryParam.offset!=\"\"'> offset #{queryParam.offset}</if>"
            + "</if> )"
            + "</script>")
    Long nodeServerDetailCount(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    @Select("<script>"
            + "select domain_name, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + " group by domain_name"
            + " order by parse_total_cnt desc limit #{queryParam.rankNumber}"
            + "</script>")
    List<ResourceDomainTopnDetail> queryNetInParseGroupByDomainType(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "parse_time, "
            + "SUM(parse_total_cnt) as parse_total_cnt, "
            + "SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt,"
            + "SUM(parse_success_cnt) as parse_success_cnt, "
            + "SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, "
            + "SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, "
            + "SUM(without_parse_total_cnt) as without_parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + " group by parse_time order by parse_time"
            + "</script>")
    List<ResourceDomainTopnDetail> queryParseTotalByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "SUM(parse_total_cnt) as parse_total_cnt "
            + "from ${queryParam.queryTable}"
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + "</script>")
    ResourceDomainTopnDetail queryParseTotalCntByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "SUM(parse_success_cnt) as parse_success_cnt, "
            + "SUM(parse_total_cnt) as parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + "</script>")
    ResourceDomainTopnDetail queryParseSuccessTotalCntByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, "
            + "SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, "
            + "SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + "</script>")
    ResourceDomainTopnDetail queryParseNetTotalCntByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, "
            + "SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(parse_total_cnt) as parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + "</script>")
    ResourceDomainTopnDetail queryParseWithTotalCntByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select "
            + "SUM(parse_total_cnt) as parse_total_cnt, "
            + "SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt,"
            + "SUM(parse_success_cnt) as parse_success_cnt, "
            + "SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, "
            + "SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, "
            + "SUM(without_parse_total_cnt) as without_parse_total_cnt "
            + "from ${queryParam.queryTable} "
            + "<where>"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + "</where>"
            + "</script>")
    ResourceDomainTopnDetail queryParseTotalCntRateByParam(@Param("queryParam") ResourceDomainTopnDetail domainTopNDetail);

    @Select("<script>"
            + "select isp, SUM(parse_total_cnt) as parse_total_cnt, SUM(a_record_parse_total_cnt) as a_record_parse_total_cnt, SUM(parse_success_cnt) as parse_success_cnt, SUM(parse_fail_cnt) as parse_fail_cnt, "
            + "SUM(net_in_parse_total_cnt) as net_in_parse_total_cnt, SUM(net_out_parse_total_cnt) as net_out_parse_total_cnt, SUM(without_parse_total_cnt) as without_parse_total_cnt, "
            + "SUM(within_parse_total_cnt) as within_parse_total_cnt, SUM(cdn_parse_total_cnt) as cdn_parse_total_cnt, SUM(cache_parse_total_cnt) as cache_parse_total_cnt, "
            + "SUM(idc_parse_total_cnt) as idc_parse_total_cnt "
            + " from ${queryParam.queryTable} where domain_name global in ("
            + " select domain_name from ${queryParam.queryTable} where 1=1"
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.domainList != null and queryParam.domainList != \"\"'><trim prefix='and (' suffix=')' suffixOverrides='or'><foreach collection='queryParam.domainList' item='domain'><if test='domain != null and domain != \"\"'> domain_name ilike concat('%' , #{domain}, '%') or</if></foreach></trim></if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by domain_name order by  sum (parse_total_cnt) desc "
            + "<if test='queryParam.rankNumber !=null and queryParam.rankNumber!=\"\" '> limit #{queryParam.rankNumber}</if> ) "
            + "<if test = 'queryParam.ispCode != null and queryParam.ispCode != \"\" '>and isp_code = #{queryParam.ispCode}</if>"
            + "<if test = 'queryParam.qtype != null and queryParam.qtype != \"\" '>and qtype = #{queryParam.qtype}</if>"
            + "<if test = 'queryParam.otherQtype'> and qtype not in ('1','2','5','28','6', '12', '15', '16','65') </if>"
            + "<if test = 'queryParam.userType != null and queryParam.userType != \"\" '>and user_type = #{queryParam.userType}</if>"
            + "<if test = 'queryParam.districtsCode != null and queryParam.districtsCode != \"\" '>and districts_code = #{queryParam.districtsCode}</if>"
            + "<if test = 'queryParam.province != null and queryParam.province != \"\" '>and province  = #{queryParam.province}</if>"
            + "<if test = 'queryParam.city != null and queryParam.city != \"\" '>and city  = #{queryParam.city}</if>"
            + "<if test = 'queryParam.district != null and queryParam.district != \"\" '>and district  = #{queryParam.district}</if>"
            + "<if test = 'queryParam.domainName != null and queryParam.domainName != \"\" '>and domain_name = #{queryParam.domainName}  </if>"
            + "<if test = 'queryParam.startTime != null'>and parse_time &gt;= #{queryParam.startTime} </if>"
            + "<if test = 'queryParam.endTime != null'>and parse_time &lt;= #{queryParam.endTime} </if>"
            + "<if test = 'queryParam.serverNodeName != null and queryParam.serverNodeName != \"\"'>and server_node_name = #{queryParam.serverNodeName} </if>"
            + " group by case when answer_first_isp is null or answer_first_isp='' then '其他' else answer_first_isp end as isp"
            + " order by parse_total_cnt desc"
            + "</script>")
    List<ResourceDomainTopnDetail> findTopNGroupByIspWebsiteReport(@Param("queryParam") ResourceDomainTopnDetail queryParam);

    List<ResourceWebsiteUserSource> findUserSource(@Param("queryParam") ResourceDomainDetailUserSourceVO resourceDomainDetailUserSourceVO);

    List<ResourceDistributionProvinceData> resourceDistributionProvince(@Param("queryParam") ResourceDistributionProvinceVO resourceDistributionProvinceVO, @Param("queryTable") String queryTable);

    List<ResourceDistributionProvinceDetail> resourceDistributionProvinceDetail(@Param("queryParam") ResourceDistributionProvinceVO resourceDistributionProvinceVO, @Param("queryTable") String queryTable);

    List<ResourceIpDetailData> getIpDetailExcelList(@Param("queryParam") ResourceDistributionProvinceVO resourceDistributionProvinceVO, @Param("queryTable") String queryTable);

    List<PopularDomainCdnReport> findCdnReport(@Param("queryParam") PopularDomainTopNCdnBusinessDetail resourceWebsiteUserSourceVO);

    List<PopularDomainCdnReport> findCdnReport2(@Param("queryParam") PopularDomainTopNCdnBusinessDetail resourceWebsiteUserSourceVO);

    Long countCdnReportlList(@Param("queryParam") PopularDomainTopNCdnBusinessDetail resourceWebsiteUserSourceVO);
}
